
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tri Fusion - Merge Sort</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: #0f172a;
    color: #e2e8f0;
    text-align: center;
    padding: 20px;
    min-height: 100vh;
    margin: 0;
  }
  h1 { color: #f1f5f9; margin-bottom: 30px; }
  .controls {
    margin: 20px 0;
  }
  button {
    padding: 12px 24px;
    margin: 0 10px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background: #3b82f6;
    color: white;
  }
  button:hover:not(:disabled) { background: #2563eb; }
  button:disabled { background: #475569; cursor: not-allowed; }
  #array {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin: 40px 0;
    flex-wrap: wrap;
  }
  .bar {
    width: 60px;
    padding: 10px 0;
    background: #475569;
    color: white;
    font-weight: bold;
    border-radius: 6px;
    transition: all 0.5s;
  }
  .left { background: #3b82f6; }
  .right { background: #8b5cf6; }
  .comparing { background: #fbbf24; transform: scale(1.1); }
  .merging { background: #ef4444; animation: pulse 0.8s infinite; }
  .sorted { background: #10b981; }
  @keyframes pulse { 0%,100% { transform: scale(1); } 50% { transform: scale(1.15); } }
  #info { margin: 30px; font-size: 18px; }
  .watermark {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(15,23,42,0.9);
    padding: 12px 24px;
    border-radius: 8px;
    border: 2px solid #10b981;
    color: white;
    font-weight: bold;
  }
  .watermark a { color: #10b981; text-decoration: none; }
  .watermark a:hover { color: #34d399; }
</style>
</head>
<body>

<h1>Tri Fusion (Merge Sort)</h1>

<div class="controls">
  <button id="start">Démarrer</button>
  <button id="random">Nouveau Tableau</button>
  <button id="speed">Vitesse ×1</button>
</div>

<div id="array"></div>
<div id="info">Cliquez sur "Nouveau Tableau" puis "Démarrer" pour voir l'animation.</div>

<div class="watermark">
  Par <strong>Amine</strong> — <a href="https://github.com/amineTNYT" target="_blank">@amineTNYT</a>
</div>

<script>
let arr = [];
let speed = 1000;
const arrayDiv = document.getElementById('array');
const info = document.getElementById('info');

document.getElementById('speed').onclick = () => {
  if (speed === 1000) { speed = 500; this.textContent = 'Vitesse ×2'; }
  else if (speed === 500) { speed = 200; this.textContent = 'Vitesse ×5'; }
  else { speed = 1000; this.textContent = 'Vitesse ×1'; }
};

function render() {
  arrayDiv.innerHTML = '';
  arr.forEach((val, i) => {
    const bar = document.createElement('div');
    bar.className = 'bar';
    bar.textContent = val;
    bar.id = 'bar' + i;
    arrayDiv.appendChild(bar);
  });
}

function randomArray() {
  arr = Array.from({length: 10}, () => Math.floor(Math.random() * 90) + 10);
  render();
  info.textContent = `Tableau : [${arr.join(', ')}] — Prêt à trier !`;
}

async function sleep(ms) {
  await new Promise(r => setTimeout(r, ms / (1000 / speed)));
}

function highlight(range, cls) {
  range.forEach(i => {
    const el = document.getElementById('bar' + i);
    if (el) el.className = 'bar ' + cls;
  });
}

async function merge(low, mid, high) {
  highlight([...Array(mid-low+1).keys()].map(i => i+low), 'left');
  highlight([...Array(high-mid).keys()].map(i => i+mid+1), 'right');
  info.textContent = `Fusion de [\( {low}- \){mid}] et [\( {mid+1}- \){high}]`;
  await sleep(800);

  let left = arr.slice(low, mid+1);
  let right = arr.slice(mid+1, high+1);
  let i = 0, j = 0, k = low;

  while (i < left.length && j < right.length) {
    document.getElementById('bar' + (low + i)).classList.add('comparing');
    document.getElementById('bar' + (mid + 1 + j)).classList.add('comparing');
    await sleep(800);

    if (left[i] <= right[j]) {
      arr[k++] = left[i++];
    } else {
      arr[k++] = right[j++];
    }
    render();
    document.getElementById('bar' + (k-1)).classList.add('merging');
    await sleep(400);
  }
  while (i < left.length) arr[k++] = left[i++];
  while (j < right.length) arr[k++] = right[j++];
  render();
}

async function mergeSort(low = 0, high = arr.length-1) {
  if (low >= high) return;
  let mid = Math.floor((low + high) / 2);
  highlight([...Array(high-low+1).keys()].map(i => i+low), 'left');
  info.textContent = `Division : [\( {low}- \){high}] → [\( {low}- \){mid}] et [\( {mid+1}- \){high}]`;
  await sleep(1000);
  render();

  await mergeSort(low, mid);
  await mergeSort(mid+1, high);
  await merge(low, mid, high);

  for (let i = low; i <= high; i++) {
    document.getElementById('bar' + i).classList.add('sorted');
  }
}

document.getElementById('start').onclick = async () => {
  if (arr.length === 0) return;
  document.querySelectorAll('button').forEach(b => b.disabled = true);
  await mergeSort();
  info.textContent = 'Tri terminé ! Tableau trié avec succès.';
  document.querySelectorAll('button').forEach(b => b.disabled = false);
};

document.getElementById('random').onclick = randomArray;

// Initial array
randomArray();
</script>

</body>
  </html>
